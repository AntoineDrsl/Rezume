<div class="wrapper-bc-cv" *ngIf="valid">

  <div class="wrapper">

    <div class="formContent">
      <h2 class="underlineHover title-cv">Quelques infos pour ton CV</h2>
      <form [formGroup]="cvForm" (ngSubmit)="onSubmit(cvForm)">

        <mat-form-field class="form-group search" appearance="standard">
          <mat-label>Poste recherché</mat-label>
          <input matInput formControlName="research" required>
          <mat-error *ngIf="research.invalid">{{getErrorMessage()}}</mat-error>
        </mat-form-field>

        <mat-form-field class="descritpion">
          <mat-label>Décrivez-vous en quelques lignes !</mat-label>
          <textarea matInput formControlName="description" required></textarea>
        </mat-form-field>

        <hr class="separator-line">

        <div formGroupName="experiences" class="experiences">
          <div class="category">
            <legend>Tes expériences
              <div (click)="addExperience()" class="plusContainer">
                <img src="/assets/images/plus.svg" alt="icon" class="icon-plus">
              </div>
            </legend>
          </div>

          <div class="input-group" *ngFor="let experienceControl of cvForm.get('experiences').controls; let i = index">
            <mat-form-field class="form-group experience" appearance="standard">
              <mat-label>Expérience</mat-label>
              <input matInput [formControlName]="i" required>
              <mat-error *ngIf="i.invalid">{{getErrorMessage()}}</mat-error>
              <mat-icon (click)="deleteExperience(i)" matSuffix>delete</mat-icon>
            </mat-form-field>
          </div>

        </div>

        <hr class="separator-line">

        <div formArray="degrees" class="degrees">
          <div class="category">
            <legend>Tes diplômes
              <div (click)="addDegree()" class="plusContainer">
                <img src="/assets/images/plus.svg" alt="icon" class="icon-plus">
              </div>
            </legend>
          </div>
          <!-- DEGREES -->
          <div class="input-group" *ngFor="let degreeGroup of cvForm.get('degrees').controls; let i = index">

            <div [formGroup]="cvForm.get('degrees').controls[i]" class="degreesGroup">
              <mat-form-field class="form-group degreeName" appearance="standard">
                <mat-label>Diplôme</mat-label>
                <input matInput [formControl]="cvForm.get('degrees').controls[i].controls.degreeName" required>
                <mat-error *ngIf="i.invalid">{{getErrorMessage()}}</mat-error>
              </mat-form-field>

              <mat-form-field class="form-group degreeDate" appearance="standard">
                <mat-label>Date d'obtention</mat-label>
                <input matInput [matDatepicker]="degreeDate" [formControl]="cvForm.get('degrees').controls[i].controls.degreeDate">
                <mat-datepicker-toggle matSuffix [for]="degreeDate"></mat-datepicker-toggle>
                <mat-datepicker #degreeDate startView="multi-year" (yearSelected)="degreeYear($event)" (monthSelected)="degreeMonth($event, degreeDate)" panelClass="example-month-picker">
                </mat-datepicker>
              </mat-form-field>

              <mat-form-field class="form-group degreeSchool" appearance="standard">
                <mat-label>Établissement</mat-label>
                <input matInput [formControl]="cvForm.get('degrees').controls[i].controls.degreeSchool" required>
                <mat-error *ngIf="i.invalid">{{getErrorMessage()}}</mat-error>
              </mat-form-field>

              <div class="deleteDegree">
                <button type="button" mat-fab color="primary" (click)="deleteDegree(i)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>

        <hr class="separator-line">

        <mat-form-field class="form-group button-cvSubmit">
          <ngx-mat-file-input #image id="image" type="file" class="input-file" formControlName="image" (change)="onFileChange($event)" #fileInput placeholder="Ta photo"></ngx-mat-file-input>
          <button mat-icon-button matSuffix *ngIf="!image.empty" (click)="image.clear($event)">
            <mat-icon>clear</mat-icon>
          </button>
        </mat-form-field>

        <div class="submitCv">
          <input type="submit" value="Créer ton CV" class="button-submitCV">
        </div>
      </form>


      <!-- Success message -->
      <div class="success" *ngIf="showSuccessMessage">
        Votre CV est créé!
      </div>

    </div>
  </div>
</div>

<div *ngIf="getCvErrorMessage">
  {{getCvErrorMessage}}
</div>
